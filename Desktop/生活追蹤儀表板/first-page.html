<html>

<head>

    <title> 生活重要場所登記頁面</title>  
</head>

    <body>


        <h1> 重要場所登記 </h1>
        <p>＃這邊應該要是一個table可以輸入重要場所的經緯度</p>
        
        <form id="locationData"   method="post">

            <p>重要場所名稱: <input type ="text" name= "登錄地點" placeholder="請輸入儲存場所">
            <br></p>
            <input type ="submit" value="Submit">

        </form>

        <br>
        
        <p></p>
        <p id="location"></p>


    
    <script>
        const x = document.getElementById("location")
        let currentPosition = null;

  
        
        function getLocation(){

            if(navigator.geolocation){
                navigator.geolocation.getCurrentPosition(showPosition);
            }else{
                x.innerHTML = "無法取得您裝置的地理位置" ;
            }
        }

        function showPosition(position){
            currentPosition = position;
            console.log('本機地理位置為:',position);
            x.innerHTML = " 緯度:" + position.coords.latitude +
            "<br> 經度:" + position.coords.longitude;     
          }

          getLocation();
     

        const form = document.getElementById('locationData');
        form.addEventListener('submit',async function(e){
            e.preventDefault();

            if(!currentPosition){
                alert('無法取得地理位置，請允許瀏覽器取得您的位置');
                return;
            }
            
            const formDataElement = document.getElementById('locationData');
            const formData = new FormData(formDataElement);
            const spot =  formData.get('登錄地點');
            
            let dataObject = {}

            dataObject['登錄地點'] = spot;
            dataObject['緯度'] = currentPosition.coords.latitude;
            dataObject['經度'] = currentPosition.coords.longitude; 
            
            try{const res = await fetch(form.action,
              {method: form.method,
                headers:{
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dataObject)
                }
             )


            if(res.ok){
                const responseData = await res.json();
                console.log('ok:',responseData);
                alert('資料已成功送出')

            }

        }catch(error){
                console.error('提交失敗',error.message);
                alert('資料送出失敗')
            }

        }
        )




    </script>
</body>


</html>